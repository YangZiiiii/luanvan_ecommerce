<!DOCTYPE html>
<!-- saved from url=(0131)https://demos.themeselection.com/materio-bootstrap-html-admin-template/html/vertical-menu-template/app-ecommerce-order-details.html -->
<html lang="en" class="layout-navbar-fixed layout-compact dark-style layout-menu-fixed" dir="ltr"
   data-theme="theme-default" data-assets-path="../../assets/" data-template="vertical-menu-template" data-style="dark">
<script async="" src="./assets/js/gtm.js"></script>
<script src="chrome-extension://eppiocemhmnlbhjplcgkofciiegomcon/content/location/location.js"
   id="eppiocemhmnlbhjplcgkofciiegomcon"></script>
<script src="chrome-extension://eppiocemhmnlbhjplcgkofciiegomcon/libs/extend-native-history-api.js"></script>
<script src="chrome-extension://eppiocemhmnlbhjplcgkofciiegomcon/libs/requests.js"></script>

<head>
   <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

   <meta name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />

   <title>
      Order Details - eCommerce | Materio - Bootstrap Material Design Admin
      Template
   </title>

   <meta name="description" content="Start your development with a Dashboard for Bootstrap 5" />
   <meta name="keywords"
      content="dashboard, material, material design, bootstrap 5 dashboard, bootstrap 5 design, bootstrap 5" />
   <!-- Canonical SEO -->
   <link rel="canonical" href="https://themeselection.com/item/materio-bootstrap-html-admin-template/" />



   <!-- Favicon -->
   <link rel="icon" type="image/x-icon"
      href="https://demos.themeselection.com/materio-bootstrap-html-admin-template/assets/img/favicon/favicon.ico" />

   <!-- Fonts -->
   <link rel="preconnect" href="https://fonts.googleapis.com/" />
   <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin="" />
   <link href="./assets/css/css2.css" rel="stylesheet" />

   <!-- Icons -->
   <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/remixicon/fonts/remixicon.css">
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
   <link rel="stylesheet" href="./assets/css/remixicon.css" />
   <link rel="stylesheet" href="./assets/css/flag-icons.css" />

   <!-- Menu waves for no-customizer fix -->
   <link rel="stylesheet" href="./assets/css/node-waves.css" />

   <!-- Core CSS -->

   <link rel="stylesheet" href="./assets/css/demo.css" />

   <!-- Vendors CSS -->
   <link rel="stylesheet" href="./assets/css/perfect-scrollbar.css" />
   <link rel="stylesheet" href="./assets/css/typeahead.css" />
   <link rel="stylesheet" href="./assets/css/datatables.bootstrap5.css" />
   <link rel="stylesheet" href="./assets/css/responsive.bootstrap5.css" />
   <link rel="stylesheet" href="./assets/css/buttons.bootstrap5.css" />
   <link rel="stylesheet" href="./assets/css/datatables.checkboxes.css" />
   <link rel="stylesheet" href="./assets/css/sweetalert2.css" />
   <link rel="stylesheet" href="./assets/css/form-validation.css" />
   <link rel="stylesheet" href="./assets/css/select2.css" />

   =

   <!-- Helpers -->
   <script src="./assets/js/helpers.js"></script>


   <!-- Template Navigation -->
   <script src="./assets/js/template/navigation.js"></script>

   <!-- Template NabBar -->
   <script src="./assets/js/template/navbar.js"></script>

   <!--? Config:  Mandatory theme config file contain global vars & default theme options, Set your preferred theme option in this file.  -->
   <script src="./assets/js/config.js"></script>
   <link rel="stylesheet" type="text/css" href="./assets/css/core-dark.css" class="template-customizer-core-css" />
   <link rel="stylesheet" type="text/css" href="./assets/css/theme-semi-dark-dark.css"
      class="template-customizer-theme-css" />


</head>

<body
   bis_register="W3sibWFzdGVyIjp0cnVlLCJleHRlbnNpb25JZCI6ImVwcGlvY2VtaG1ubGJoanBsY2drb2ZjaWllZ29tY29uIiwiYWRibG9ja2VyU3RhdHVzIjp7IkRJU1BMQVkiOiJkaXNhYmxlZCIsIkZBQ0VCT09LIjoiZGlzYWJsZWQiLCJUV0lUVEVSIjoiZGlzYWJsZWQiLCJSRURESVQiOiJkaXNhYmxlZCIsIlBJTlRFUkVTVCI6ImRpc2FibGVkIiwiSU5TVEFHUkFNIjoiZGlzYWJsZWQiLCJMSU5LRURJTiI6ImRpc2FibGVkIiwiQ09ORklHIjoiZGlzYWJsZWQifSwidmVyc2lvbiI6IjIuMC4yMCIsInNjb3JlIjoyMDAyMH1d"
   __processed_75cbc999-ea02-48a3-bc2e-c679bca00cfa__="true">


   <!-- Layout wrapper -->
   <div class="layout-wrapper layout-content-navbar" bis_skin_checked="1">
      <div class="layout-container" bis_skin_checked="1">
         <!-- Menu -->

         <navigation-main></navigation-main>
         <!-- / Menu -->

         <!-- Layout container -->
         <div class="layout-page" bis_skin_checked="1">
            <!-- Navbar -->

            <navbar-main></navbar-main>

            <!-- / Navbar -->

            <!-- Content wrapper -->
            <div class="content-wrapper" bis_skin_checked="1">
               <!-- Content -->

               <div class="container-xxl flex-grow-1 container-p-y" bis_skin_checked="1">
                  <!-- ... (phần đầu giữ nguyên) ... -->

                  <!-- Order Details Table -->
                  <div class="row" bis_skin_checked="1">
                     <div class="col-12 col-lg-8" bis_skin_checked="1">
                        <div class="card mb-6" bis_skin_checked="1">
                           <div class="card-header d-flex justify-content-between align-items-center"
                              bis_skin_checked="1">
                              <h5 class="card-title m-0">Order details</h5>
                              <h6 class="m-0">
                                 <a href="javascript:void(0)">Edit</a>
                              </h6>
                           </div>
                           <div class="card-datatable table-responsive" bis_skin_checked="1">
                              <table class="table dataTable no-footer dtr-column" id="order-items-table">
                                 <thead>
                                    <tr>
                                       <th></th>
                                       <th></th>
                                       <th class="w-50">products</th>
                                       <th>price</th>
                                       <th>qty</th>
                                       <th>total</th>
                                    </tr>
                                 </thead>
                                 <tbody id="order-items-body">
                                    <!-- Dữ liệu sản phẩm sẽ được render bằng JS -->
                                 </tbody>
                              </table>
                              <div class="d-flex justify-content-end align-items-center m-4 p-1 mb-0 pb-0"
                                 bis_skin_checked="1">
                                 <div class="order-calculations" bis_skin_checked="1">
                                    <div class="d-flex justify-content-start gap-4 mb-2" bis_skin_checked="1">
                                       <span class="w-px-100 text-heading">Subtotal:</span>
                                       <h6 class="mb-0" id="order-subtotal">0</h6>
                                    </div>
                                    <div class="d-flex justify-content-start gap-4 mb-2" bis_skin_checked="1">
                                       <span class="w-px-100 text-heading">Discount:</span>
                                       <h6 class="mb-0" id="order-discount">0</h6>
                                    </div>
                                    <div class="d-flex justify-content-start gap-4 mb-2" bis_skin_checked="1">
                                       <span class="w-px-100 text-heading">Tax:</span>
                                       <h6 class="mb-0" id="order-tax">0</h6>
                                    </div>
                                    <div class="d-flex justify-content-start gap-4" bis_skin_checked="1">
                                       <h6 class="w-px-100 mb-0">Total:</h6>
                                       <h6 class="mb-0" id="order-total">0</h6>
                                    </div>
                                 </div>
                              </div>
                           </div>
                        </div>
                     </div>
                     <div class="col-12 col-lg-4" bis_skin_checked="1">
                        <div class="card mb-6" bis_skin_checked="1">
                           <div class="card-body" bis_skin_checked="1">
                              <h5 class="card-title mb-6">Customer details</h5>
                              <div class="d-flex justify-content-start align-items-center mb-6" bis_skin_checked="1">
                                 <div class="avatar me-3" bis_skin_checked="1">
                                    <img id="customer-avatar" src="./assets/img/OrderDetails/1.png" alt="Avatar"
                                       class="rounded-circle" />
                                 </div>
                                 <div class="d-flex flex-column" bis_skin_checked="1">
                                    <a href="#">
                                       <h6 class="mb-0" id="customer-name">Customer Name</h6>
                                    </a>
                                    <span id="customer-id">Customer ID: #</span>
                                 </div>
                              </div>
                              <div class="d-flex justify-content-start align-items-center mb-6" bis_skin_checked="1">
                                 <span
                                    class="avatar rounded-circle bg-label-success me-3 d-flex align-items-center justify-content-center"><i
                                       class="ri-shopping-cart-line ri-24px"></i></span>
                                 <h6 class="text-nowrap mb-0" id="customer-orders">0 Orders</h6>
                              </div>
                              <div class="d-flex justify-content-between" bis_skin_checked="1">
                                 <h6 class="mb-1">Contact info</h6>
                              </div>
                              <p class="mb-1" id="customer-email">Email: </p>
                              <p class="mb-0" id="customer-phone">Mobile: </p>
                           </div>
                        </div>
                     </div>
                  </div>

                  <div class="row">
                     <div class="col-12">
                        <div class="card mb-6" bis_skin_checked="1">
                           <div class="card-header" bis_skin_checked="1">
                              <h5 class="card-title m-0">Shipping activity</h5>
                           </div>
                           <div class="card-body mt-3" bis_skin_checked="1">
                              <ul class="timeline pb-0 mb-0" id="order-timeline">
                                 <!-- Timeline sẽ được render bằng JS -->
                              </ul>
                           </div>
                        </div>
                     </div>
                  </div>
               </div>

               <script>
                  const urlParams = new URLSearchParams(window.location.search);
                  const orderId = urlParams.get('orderId');
                  const API_URL = `http://localhost:8080/api/v1/order/${orderId}`;

                  const ORDER_STATUS_STEPS = [
                     {
                        key: "PENDING",
                        label: "Order was placed",
                        desc: "Your order has been placed successfully"
                     },
                     {
                        key: "PROCESSING",
                        label: "Processing",
                        desc: "Your order is being processed"
                     },
                     {
                        key: "SHIPPING",
                        label: "Shipped",
                        desc: "Order is been shipped"
                     },
                     {
                        key: "DELIVERED",
                        label: "Delivered",
                        desc: "Order delivered to customer"
                     },
                     {
                        key: "CANCELLED",
                        label: "Cancelled",
                        desc: "Order has been cancelled"
                     },
                     {
                        key: "RETURNED",
                        label: "Returned",
                        desc: "Order has been returned"
                     },
                     {
                        key: "REFUNDED",
                        label: "Refunded",
                        desc: "Order has been refunded"
                     }
                  ];

                  function formatMoney(amount) {
                     return amount ? amount.toLocaleString('vi-VN', { style: 'currency', currency: 'VND' }) : '0';
                  }

                  function formatDate(ts) {
                     if (!ts) return '';
                     const d = new Date(ts);
                     return d.toLocaleString();
                  }

                  function renderOrderItems(items) {
                     return items.map(item => `
                     <tr>
                        <td></td>
                        <td></td>
                        <td>
                           <div class="d-flex justify-content-start align-items-center product-name">
                              <div class="avatar-wrapper me-3">
                                 <div class="avatar avatar-sm rounded-2 bg-label-secondary">
                                    <img src="${item.imageUrl || './assets/img/OrderDetails/woodenchair.png'}" alt="product-${item.productName}" class="rounded-2" />
                                 </div>
                              </div>
                              <div class="d-flex flex-column">
                                 <span class="text-nowrap text-heading fw-medium">${item.productName}</span>
                              </div>
                           </div>
                        </td>
                        <td><span>${formatMoney(item.unitPrice)}</span></td>
                        <td><span>${item.quantity}</span></td>
                        <td><span>${formatMoney(item.unitPrice * item.quantity)}</span></td>
                     </tr>
                  `).join('');
                  }

                  function renderTimeline(status, order) {
                     // Chỉ highlight đến trạng thái hiện tại
                     const statusIndex = ORDER_STATUS_STEPS.findIndex(s => s.key === status);
                     let steps = [];
                     if (statusIndex === -1) {
                        // Nếu không khớp trạng thái, chỉ hiển thị trạng thái đầu tiên
                        steps = [ORDER_STATUS_STEPS[0]];
                     } else if (status === "CANCELLED" || status === "RETURNED" || status === "REFUNDED") {
                        // Nếu là trạng thái kết thúc sớm, chỉ hiển thị các bước đến trạng thái đó
                        steps = ORDER_STATUS_STEPS.slice(0, statusIndex + 1);
                     } else {
                        steps = ORDER_STATUS_STEPS.slice(0, statusIndex + 1);
                     }

                     return steps.map((step, idx) => {
                        let borderClass = (idx === steps.length - 1 && (status === "CANCELLED" || status === "RETURNED" || status === "REFUNDED")) ? "border-danger" : "border-primary";
                        let pointClass = (idx === steps.length - 1 && (status === "CANCELLED" || status === "RETURNED" || status === "REFUNDED")) ? "timeline-point-danger" : "timeline-point-primary";
                        let time = "";
                        if (idx === 0 && order.orderDate) time = formatDate(order.orderDate);
                        else if (idx === steps.length - 1 && order.updatedAt) time = formatDate(order.updatedAt);
                        return `
                        <li class="timeline-item timeline-item-transparent ${borderClass}">
                           <span class="timeline-point ${pointClass}"></span>
                           <div class="timeline-event">
                              <div class="timeline-header mb-1">
                                 <h6 class="mb-0">${step.label}${idx === 0 ? ` (Order ID: #${order.id.slice(0, 6)})` : ""}</h6>
                                 <small class="text-muted">${time}</small>
                              </div>
                              <p class="mt-1 mb-3">${step.desc}</p>
                           </div>
                        </li>
                     `;
                     }).join('');
                  }

                  fetch(API_URL)
                     .then(res => res.json())
                     .then(json => {
                        if (json.statusCode !== 200) throw new Error(json.message);
                        const order = json.data;

                        // Render sản phẩm
                        document.getElementById('order-items-body').innerHTML = renderOrderItems(order.items);

                        // Render tổng tiền
                        document.getElementById('order-subtotal').textContent = formatMoney(order.totalPrice);
                        document.getElementById('order-discount').textContent = formatMoney(0);
                        document.getElementById('order-tax').textContent = formatMoney(0);
                        document.getElementById('order-total').textContent = formatMoney(order.totalPrice);

                        // Render thông tin khách hàng
                        if (order.user) {
                           document.getElementById('customer-name').textContent = `${order.user.firstName} ${order.user.lastName}`;
                           document.getElementById('customer-id').textContent = `Customer ID: #${order.user.uid}`;
                           document.getElementById('customer-email').textContent = `Email: ${order.user.email}`;
                           document.getElementById('customer-phone').textContent = `Mobile: ${order.user.phone}`;
                           document.getElementById('customer-avatar').src = order.user.avatar || './assets/img/OrderDetails/1.png';
                        }

                        // Render timeline
                        document.getElementById('order-timeline').innerHTML = renderTimeline(order.orderStatus, order);
                     })
                     .catch(err => {
                        document.getElementById('order-timeline').innerHTML = `<li><span class="text-danger">Không thể tải đơn hàng: ${err.message}</span></li>`;
                     });
               </script>
               <!-- / Content -->

               <!-- Footer -->
               <footer class="content-footer footer bg-footer-theme">
                  <div class="container-xxl" bis_skin_checked="1">
                     <div
                        class="footer-container d-flex align-items-center justify-content-between py-4 flex-md-row flex-column"
                        bis_skin_checked="1">
                        <div class="text-body mb-2 mb-md-0" bis_skin_checked="1">
                           ©
                           <script>
                              document.write(new Date().getFullYear());
                           </script>
                           2025, made with
                           <span class="text-danger"><i class="tf-icons ri-heart-fill"></i></span>
                           by
                           <a href="https://themeselection.com/" target="_blank" class="footer-link">ThemeSelection</a>
                        </div>
                        <div class="d-none d-lg-inline-block" bis_skin_checked="1">
                           <a href="https://themeselection.com/license/" class="footer-link me-4"
                              target="_blank">License</a>
                           <a href="https://themeselection.com/" target="_blank" class="footer-link me-4">More
                              Themes</a>

                           <a href="https://demos.themeselection.com/materio-bootstrap-html-admin-template/documentation/"
                              target="_blank" class="footer-link me-4">Documentation</a>

                           <a href="https://themeselection.com/support/" target="_blank"
                              class="footer-link d-none d-sm-inline-block">Support</a>
                        </div>
                     </div>
                  </div>
               </footer>
               <!-- / Footer -->

               <div class="content-backdrop fade" bis_skin_checked="1"></div>
            </div>
            <!-- Content wrapper -->
         </div>
         <!-- / Layout page -->
      </div>

      <!-- Overlay -->
      <div class="layout-overlay layout-menu-toggle" bis_skin_checked="1"></div>

      <!-- Drag Target Area To SlideIn Menu On Small Screens -->
      <div class="drag-target" style="
               touch-action: pan-y;
               user-select: none;
               -webkit-user-drag: none;
               -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
            " bis_skin_checked="1"></div>
   </div>
   <!-- / Layout wrapper -->



   <!-- Core JS -->
   <!-- build:js assets/vendor/js/core.js -->
   <script src="./assets/js/jquery.js"></script>
   <script src="./assets/js/popper.js"></script>
   <script src="./assets/js/bootstrap.js"></script>
   <script src="./assets/js/node-waves.js"></script>
   <script src="./assets/js/perfect-scrollbar.js"></script>
   <script src="./assets/js/hammer.js"></script>
   <script src="./assets/js/i18n.js"></script>
   <script src="./assets/js/typeahead.js"></script>
   <script type="text/javascript" id="" charset="">
      console.log("TS:GTM Worked");
   </script>
   <script src="./assets/js/menu.js"></script>

   <!-- endbuild -->

   <!-- Vendors JS -->
   <script src="./assets/js/datatables-bootstrap5.js"></script>
   <script src="./assets/js/sweetalert2.js"></script>
   <script src="./assets/js/cleave.js"></script>
   <script src="./assets/js/cleave-phone.js"></script>
   <script src="./assets/js/popular.js"></script>
   <script src="./assets/js/bootstrap5.js"></script>
   <script src="./assets/js/auto-focus.js"></script>
   <script src="./assets/js/select2.js"></script>

   <!-- Main JS -->
   <script src="./assets/js/main.js"></script>

   <!-- Page JS -->
   <script src="./assets/js/OrderDetails/app-ecommerce-order-details.js"></script>
   <script src="./assets/js/modal-add-new-address.js"></script>
   <script src="./assets/js/modal-edit-user.js"></script>



</body>

</html>